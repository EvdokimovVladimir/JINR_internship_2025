# Alpha Spectrum Analysis

Этот проект предназначен для анализа спектров альфа-частиц, полученных в экспериментах. Он предоставляет инструменты для обработки данных, подгонки пиков, визуализации результатов и анализа зависимостей параметров спектров от различных условий эксперимента.

> **Примечание**: Код написан с использованием GitHub Copilot.

## Основные возможности

- **Анализ отдельных спектров**: Подгонка гауссиан к пикам для определения их параметров (амплитуда, центр, ширина).
- **Пакетный анализ**: Автоматизация обработки нескольких спектров с сохранением результатов в отдельные папки.
- **Сбор данных о пиках**: Создание сводного файла с параметрами пиков для всех спектров.
- **Визуализация**: Построение графиков спектров с наложением результатов подгонки и без них.
- **Анализ зависимостей**: Построение графиков зависимости параметров пиков от экспериментальных условий (например, напряжения).

## Оглавление <!-- omit from toc -->
- [Alpha Spectrum Analysis](#alpha-spectrum-analysis)
  - [Основные возможности](#основные-возможности)
  - [Структура проекта](#структура-проекта)
  - [Подготовка](#подготовка)
  - [Использование](#использование)
  - [Настройка параметров](#настройка-параметров)
  - [Примечание](#примечание)
  - [Пример файла спектра](#пример-файла-спектра)


## Структура проекта

### alpha_spectrum_analysis.py
Этот скрипт является основным инструментом для анализа одного спектра. Он включает в себя функции для подгонки гауссиан к пикам, что позволяет точно определить параметры пиков, такие как амплитуда, центр и ширина (FWHM). Для этого используется библиотека `scipy.optimize` и метод `curve_fit`. Также скрипт включает функции для расчёта метрик качества фита, таких как коэффициент детерминации (R²), что позволяет оценить точность подгонки.

Входные данные загружаются из текстового файла, который содержит информацию о канале, энергии и количестве событий. Скрипт разделяет данные на соответствующие столбцы и выделяет область вокруг референсного пика для дальнейшего анализа. Это позволяет сосредоточиться на наиболее значимых данных и исключить шум.

Для визуализации результатов скрипт строит графики, на которых отображаются исходные данные и результаты подгонки. Графики сохраняются в логарифмическом масштабе, что позволяет лучше видеть детали в широком диапазоне значений. Также предусмотрена возможность автоматического сохранения графиков с уникальными именами.

Помимо подгонки гауссиан, скрипт включает простой метод анализа, который позволяет определить границы бета-спектра без использования сложных алгоритмов. Это полезно для быстрого анализа данных, когда точность не является критически важной.

Скрипт также поддерживает логирование, что позволяет отслеживать процесс выполнения и сохранять важную информацию, такую как параметры подгонки и границы спектров. Логи сохраняются в текстовых файлах, что упрощает их последующий анализ.

### batch_alpha_spectrum_analysis.py
Этот скрипт автоматизирует процесс анализа нескольких спектров. Он проходит по всем файлам в папке `spectra`, копирует их в соответствующие подпапки в папке `results` и запускает `alpha_spectrum_analysis.py` для каждого файла. Это позволяет быстро обработать большое количество данных без необходимости вручную запускать анализ для каждого спектра.

Скрипт также обеспечивает изоляцию результатов для каждого спектра, создавая отдельные папки для каждого файла. Это упрощает управление данными и предотвращает их смешивание. Кроме того, он использует переменные окружения для передачи имени файла в `alpha_spectrum_analysis.py`, что делает процесс более гибким.

### collect_peak_fits.py
Этот скрипт собирает данные о пиках из всех файлов результатов (FIT_*.txt) и формирует сводный файл `summary_peak_fits.txt`. Он проходит по всем подпапкам в папке `results`, извлекает информацию из файлов фитов и объединяет её в один файл. Это позволяет легко анализировать данные о пиках для всех спектров.

Скрипт также включает функцию для извлечения информации из имени файла, что позволяет автоматически добавлять метаданные, такие как напряжение, ток и температура, в сводный файл. Это делает данные более полными и удобными для анализа.

### plot_all_spectra_with_fits.py
Этот скрипт строит графики всех спектров с наложением результатов фитов. Он загружает данные из папки `spectra` и результаты фитов из папки `results`, а затем отображает их на одном графике. Это позволяет визуально оценить качество подгонки для всех спектров.

Скрипт также добавляет вертикальные линии для обозначения позиций пиков и кривые подгонки, что делает графики более информативными. Результаты сохраняются в виде изображений в папке `results`.

### plot_all_spectra.py
Этот скрипт строит графики всех спектров без фитов. Он загружает данные из папки `spectra` и отображает их на отдельных подграфиках. Это полезно для быстрого просмотра всех спектров и выявления аномалий в данных.

Скрипт использует логарифмический масштаб для оси Y, что позволяет лучше видеть детали в данных с широким диапазоном значений. Графики сохраняются в папке `results`.

### plot_summary_peak_fits.py
Этот скрипт анализирует сводный файл `summary_peak_fits.txt` и строит графики зависимости параметров пиков (позиции, ширины, амплитуды) от напряжения. Это позволяет выявить тренды и зависимости в данных.

Скрипт также строит графики нормализованных позиций пиков и FWHM, что упрощает сравнение данных для разных спектров. Результаты сохраняются в виде изображений в папке `results`.

### run_all_scripts.py
Этот скрипт запускает все остальные скрипты в правильной последовательности для выполнения полного анализа данных. Он обеспечивает автоматизацию всего процесса, от анализа отдельных спектров до построения итоговых графиков.

Скрипт также проверяет наличие каждого файла перед его запуском, что предотвращает ошибки из-за отсутствия файлов. Результаты выполнения каждого скрипта выводятся в консоль, что упрощает отслеживание процесса.

## Подготовка

1. Убедитесь, что у вас установлен Python 3.8 или выше.
2. Установите необходимые зависимости, выполнив команду:
   ```bash
   pip install -r requirements.txt
   ```
3. Проверьте, что структура папок соответствует описанной в разделе "Структура проекта". Убедитесь, что папки `spectra` и `results` существуют.

## Использование

1. Запустите `run_all_scripts.py` для выполнения полного анализа данных.
2. Для выполнения отдельных шагов анализа вы можете запускать скрипты по отдельности:
   - `alpha_spectrum_analysis.py` для анализа одного спектра.
   - `batch_alpha_spectrum_analysis.py` для анализа нескольких спектров.
   - `collect_peak_fits.py` для создания сводного файла с данными о пиках.
   - `plot_all_spectra_with_fits.py` для построения графиков спектров с наложением фитов.
   - `plot_all_spectra.py` для построения графиков спектров без фитов.
   - `plot_summary_peak_fits.py` для анализа и построения итоговых графиков параметров пиков.
3. Результаты будут сохранены в папке `results/`.

## Настройка параметров

Скрипты в этом проекте поддерживают настройку параметров для гибкой работы с данными. Ниже приведён список параметров, которые можно изменить, и способы их настройки.

### alpha_spectrum_analysis.py
1. **Имя входного файла**:
   - Параметр: `ALPHA_SPECTRUM_FILENAME`
   - Описание: Указывает имя файла спектра для анализа.
   - Настройка: Передаётся через переменные окружения.
     ```bash
     export ALPHA_SPECTRUM_FILENAME="example_spectrum.txt"
     ```

2. **Режим пакетной обработки**:
   - Параметр: `ALPHA_SPECTRUM_BATCH`
   - Описание: Если установлено в `1`, графики автоматически сохраняются и окна не открываются.
   - Настройка: Передаётся через переменные окружения.
     ```bash
     export ALPHA_SPECTRUM_BATCH="1"
     ```

3. **Диапазон энергии для анализа референсного пика**:
   - Параметры: `ref_peak_min`, `ref_peak_max`
   - Описание: Определяют диапазон энергии для выделения референсного пика.
   - Настройка: Изменяется в коде скрипта.

4. **Начальные параметры для фиттинга гауссианы**:
   - Параметр: `initial_guess`
   - Описание: Начальные значения для амплитуды, центра и ширины гауссианы.
   - Настройка: Изменяется в коде скрипта.

5. **Сохранение графиков**:
   - Параметр: `savefig_auto`
   - Описание: Автоматически сохраняет графики с уникальными именами.
   - Настройка: Используется в коде, имя файла формируется автоматически.

### batch_alpha_spectrum_analysis.py
1. **Папка с исходными спектрами**:
   - Параметр: `spectra_dir`
   - Описание: Указывает папку, где находятся файлы спектров.
   - Настройка: Изменяется в коде скрипта.

2. **Папка для сохранения результатов**:
   - Параметр: `results_dir`
   - Описание: Указывает папку, куда сохраняются результаты анализа.
   - Настройка: Изменяется в коде скрипта.

3. **Передача параметров в `alpha_spectrum_analysis.py`**:
   - Параметры: `ALPHA_SPECTRUM_FILENAME`, `ALPHA_SPECTRUM_BATCH`
   - Описание: Передаются через переменные окружения для каждого файла.

### collect_peak_fits.py
1. **Папка с результатами**:
   - Параметр: `results_dir`
   - Описание: Указывает папку, где находятся файлы с результатами фитов.
   - Настройка: Изменяется в коде скрипта.

2. **Имя итогового файла**:
   - Параметр: `output_file`
   - Описание: Указывает имя файла, куда сохраняются сводные данные.
   - Настройка: Изменяется в коде скрипта.

### plot_all_spectra.py
1. **Папка с исходными спектрами**:
   - Параметр: `spectra_dir`
   - Описание: Указывает папку, где находятся файлы спектров.
   - Настройка: Изменяется в коде скрипта.

2. **Имя выходного файла**:
   - Параметр: `output_file`
   - Описание: Указывает имя файла, куда сохраняется график.
   - Настройка: Изменяется в коде скрипта.

### plot_all_spectra_with_fits.py
1. **Папки с данными**:
   - Параметры: `spectra_dir`, `results_dir`
   - Описание: Указывают папки с исходными спектрами и результатами фитов.
   - Настройка: Изменяется в коде скрипта.

2. **Имя выходного файла**:
   - Параметр: `output_file`
   - Описание: Указывает имя файла, куда сохраняется график.
   - Настройка: Изменяется в коде скрипта.

### plot_summary_peak_fits.py
1. **Файл с данными**:
   - Параметр: `filepath`
   - Описание: Указывает путь к файлу `summary_peak_fits.txt`.
   - Настройка: Изменяется в коде скрипта.

2. **Параметры графиков**:
   - Описание: Настраиваются параметры осей, заголовков и подписей графиков.
   - Настройка: Изменяется в функциях построения графиков.

### run_all_scripts.py
1. **Список скриптов для выполнения**:
   - Параметр: `scripts`
   - Описание: Указывает последовательность скриптов для выполнения.
   - Настройка: Изменяется в коде скрипта.

2. **Backend для matplotlib**:
   - Параметр: `MPLBACKEND`
   - Описание: Устанавливается в `Agg`, чтобы подавить открытие окон с графиками.
   - Настройка: Передаётся через переменные окружения.

## Примечание
Перед запуском убедитесь, что все входные данные находятся в папке `spectra`, а папка `results` пуста или содержит только результаты предыдущих запусков.

## Пример файла спектра

Файл спектра представляет собой текстовый файл, где каждая строка содержит три значения, разделённые пробелами или табуляцией: номер канала, энергия (в кэВ) и количество событий. Пример содержимого файла спектра:

```
0	161.736	2
1	162.248	0
2	162.760	140944
3	163.272	140128
```

В этом примере:
- Первый столбец — номер канала.
- Второй столбец — энергия, соответствующая каналу (в кэВ).
- Третий столбец — количество событий, зарегистрированных в данном канале.

Убедитесь, что формат вашего файла соответствует этому примеру, чтобы скрипты могли корректно обработать
